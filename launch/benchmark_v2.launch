<?xml version="1.0"?>

<!-- roslaunch boris_drone benchmark.launch rpt2:=-1 rpt3:=-1 -->


<launch>
  <arg name="file_in"                default="benchmark"/>
  <arg name="max_matches"            default="200"/>
  <arg name="test_robustness"        default="false"/>
  <arg name="no_bundle_adjustment"   default="false"/>
  <arg name="dlt_triangulation"      default="false"/>
  <arg name="midpoint_triangulation" default="false"/>
  <arg name="double_ba"              default="false"/>
  <arg name="bundle_adjustment_tol"  default="0.05"/>
  <arg name="rpt2"                   default="-1" />
  <arg name="rpt3"                   default="-1" />
  <arg name="remove_cst"             default="0" />
  <arg name="remove_coeff"           default="-1" />
  <arg name="huber_delta"            default="1.0" />
  <arg name="file_out"  default="result_robust_$(arg test_robustness)_mm_$(arg max_matches)_batol_$(arg bundle_adjustment_tol)_rpt2_$(arg rpt2)_rpt3_$(arg rpt3)_double_$(arg double_ba)_rmvcst_$(arg remove_cst)_rmvcoeff_$(arg remove_coeff)_huberdelta_$(arg huber_delta)_noba_$(arg no_bundle_adjustment)_mid_$(arg midpoint_triangulation)_dlt_$(arg dlt_triangulation)"/>

  <arg name="min_dist"        default="0.2" />
  <arg name="min_time"        default="1.5" />
  <arg name="time_thresh"     default="5" />
  <arg name="inliers_thresh"  default="70" />
  <arg name="n_kf_local_ba"   default="6" />
  <arg name="freq_global_ba"  default="50" />

  <include file="$(find boris_drone)/launch/global_params.xml" />
  <include file="$(find boris_drone)/launch/gui.xml" />
  <include file="$(find boris_drone)/launch/slam.xml" >
    <arg name="max_matches"            value="$(arg max_matches)"/>
    <arg name="test_robustness"        value="$(arg test_robustness)"/>
    <arg name="no_bundle_adjustment"   value="$(arg no_bundle_adjustment)"/>
    <arg name="midpoint_triangulation" value="$(arg midpoint_triangulation)"/>
    <arg name="dlt_triangulation"      value="$(arg dlt_triangulation)"/>
    <arg name="double_ba"              value="$(arg double_ba)"/>
    <arg name="bundle_adjustment_tol"  value="$(arg bundle_adjustment_tol)"/>
    <arg name="rpt2"                   value="$(arg rpt2)"/>
    <arg name="rpt3"                   value="$(arg rpt3)"/>
    <arg name="remove_cst"             value="$(arg remove_cst)"/>
    <arg name="remove_coeff"           value="$(arg remove_coeff)"/>
    <arg name="only_init"              value="false" />
    <arg name="huber_delta"            value="$(arg huber_delta)"/>
    <arg name="benchmark"              value="true" />

    <arg name="min_dist"       default="$(arg min_dist)" />
    <arg name="min_time"       default="$(arg min_time)" />
    <arg name="time_thresh"    default="$(arg time_thresh)" />
    <arg name="inliers_thresh" default="$(arg inliers_thresh)" />
    <arg name="n_kf_local_ba"  default="$(arg n_kf_local_ba)" />
    <arg name="freq_global_ba" default="$(arg freq_global_ba)" />
  </include>

  <node name="boris_drone_manual_pose_estimation" pkg="boris_drone" type="manual_pose_estimation" output="screen"></node>
  <node pkg="rosbag" type="play"   name="player"   output="screen" args="-q /home/$(env USER)/bagfiles/$(arg file_in).bag -r 0.75"/>
  <node pkg="rosbag" type="record" name="recorder" output="screen" args="-O /home/$(env USER)/bagfiles/$(arg file_out).bag /pose_visual /pose_estimation /benchmark"/>
  <node name="boris_drone_computer_vision" pkg="boris_drone" type="computer_vision" output="screen">
    <param name="video_channel" value="ardrone/front/image_rect_color"/>
    <param name="cam_type" value="front"/>
    <param name="use_OpticalFlowPyrLK" value="true"/>
    <param name="autonomy_unavailable" value="true"/>
  </node>

</launch>
